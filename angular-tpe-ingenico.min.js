"use strict";angular.module("ngTpeIngenico",[]).factory("$tpeIngenico",["$websocket","$q","$timeout",function(t,e,n){function o(){l||(l=!0,u.reconnect())}var r,a=this,i={idle:1,in_payment:2},c=i.idle,s=12e4,u=t("ws://localhost:8787"),l=!1,p=e.defer();u.onMessage(function(t){a.response=t.data;try{var e=h(a.response);!1!==e&&p.notify(a.response)}catch(n){p.reject(n)}}),u.onError(function(){l=!1,console.log("connection Error"),r=setInterval(o(),5e3)}),u.onClose(function(){l=!1,console.log("connection closed"),r=setInterval(o,5e3)}),u.onOpen(function(){l=!0,console.log("connection open"),clearInterval(r)});var f=function(t){this.message=t,this.name="PaymentException"},h=function(t){var e;try{e=JSON.parse(t)}catch(n){throw new f("Parsing error:",n)}if("object"!=typeof e)throw new f("paymentResponse is not an object");return e.hasOwnProperty("checkout_state")&&e.hasOwnProperty("checkout_details")?e:!1},w=function(t){if("object"!=typeof t)throw new f("paymentObject is not an object");if(!t.hasOwnProperty("action"))throw new f("attribute action is missing");if(!t.hasOwnProperty("data"))throw new f("attribute data is missing");var e=t.data;if(!(e.hasOwnProperty("id")&&e.hasOwnProperty("number")&&e.hasOwnProperty("total_ttc")&&e.hasOwnProperty("items")))throw new f("mandatory field is missing");if(e.id<=0)throw new f("paymentObject.id can't be null");if(e.total_ttc<=0)throw new f("paymentObject.total_ttc can't be null");if(e.items.length<=0)throw new f("paymentObject.items can't be null");return!0},y=function(){return p.promise},m=function(t){var o=e.defer();try{w(t),a.paymentObject=t,a.currentState=i.payment_in_progress,u.send(JSON.stringify(t));{n(function(){a.currentState=i.idle,o.reject("response timeout")},s)}y().then(null,null,function(t){a.currentState=i.idle,o.resolve(t)})}catch(r){a.currentState=i.idle,o.reject(r)}return o.promise};return{currentState:c,paymentRequest:m}}]);
//# sourceMappingURL=angular-tpe-ingenico.min.js.map