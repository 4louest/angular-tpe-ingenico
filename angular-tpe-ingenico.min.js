"use strict";angular.module("ngTpeIngenico",[]).factory("$tpeIngenico",["$websocket","$q","$timeout",function(t,e,n){var r,o=this,a={idle:1,in_payment:2},c=a.idle,i=12e4,s=t("ws://localhost:8787"),l=e.defer();s.onMessage(function(t){o.response=t.data;try{var e=p(o.response);!1!==e&&l.notify(o.response)}catch(n){l.reject(n)}}),s.onError(function(){console.log("connection Error"),r=setInterval(reconnect(),5e3)}),s.onClose(function(){console.log("connection closed"),r=setInterval(reconnect,5e3)}),s.onOpen(function(){console.log("connection open"),clearInterval(r)});var u=function(t){this.message=t,this.name="PaymentException"},p=function(t){var e;try{e=JSON.parse(t)}catch(n){throw new u("Parsing error:",n)}if("object"!=typeof e)throw new u("paymentResponse is not an object");return e.hasOwnProperty("checkout_state")&&e.hasOwnProperty("checkout_details")?e:!1},f=function(t){if("object"!=typeof t)throw new u("paymentObject is not an object");if(!t.hasOwnProperty("action"))throw new u("attribute action is missing");if(!t.hasOwnProperty("data"))throw new u("attribute data is missing");var e=t.data;if(!(e.hasOwnProperty("id")&&e.hasOwnProperty("number")&&e.hasOwnProperty("total_ttc")&&e.hasOwnProperty("items")))throw new u("mandatory field is missing");if(e.id<=0)throw new u("paymentObject.id can't be null");if(e.total_ttc<=0)throw new u("paymentObject.total_ttc can't be null");if(e.items.length<=0)throw new u("paymentObject.items can't be null");return!0},h=function(){return l.promise},w=function(t){var r=e.defer();try{f(t),o.paymentObject=t,o.currentState=a.payment_in_progress,s.send(JSON.stringify(t));{n(function(){o.currentState=a.idle,r.reject("response timeout")},i)}h().then(null,null,function(t){o.currentState=a.idle,r.resolve(t)})}catch(c){o.currentState=a.idle,r.reject(c)}return r.promise};return{currentState:c,paymentRequest:w}}]);
//# sourceMappingURL=angular-tpe-ingenico.min.js.map